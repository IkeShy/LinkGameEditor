{"version":3,"sources":["../../../../../../../assets/lcGame/scripts/layers/gameArea/assets/lcGame/scripts/layers/gameArea/lc_layer_container.js"],"names":["cc","Class","extends","tm","GameWapper","properties","_startX","_startY","_curLevelInfo","_containerList","_chanceLogic","_lineList","lineNode","Node","linePrefab","Prefab","containerNode","containerPrefab","onLoad","_super","_initLine","_initListen","getContentSize","width","height","node","getComponent","_parseInfo","register","lc","Event","GameEvent","HideLastLine","_onHideLastLine","CrashOtherContainer","_onCrashOtherContainer","line","instantiate","active","addChild","_line","game","levelMgr","getLevelInfo","_createContainer","col","length","oneCol","raw","info","_createOneContainer","oneWidth","oneHeight","x","y","cLogic","_addOneContainerBackLogic","setPos","v2","setContainer","cline","_addOneLineBackLogic","pos","hide","container","mContainer","mLine","start","_initTouchEvent","on","NodeEventType","TOUCH_START","event","_onTouchStart","TOUCH_MOVE","_onTouchMove","TOUCH_END","_onTouchFinish","TOUCH_CANCEL","location","getLocation","ele","_getEleInTouch","isCanChance","LOGD","logicX","logicY","_changeCurEle","_showLineByEle","show","setHigh","_setLineHeightAndRotationByEle","end","convertToNodeSpaceAR","dis","sub","mag","posSub","angle","Math","atan2","PI","setRotation","_hideLine","curEle","getCurEle","to","count","GameEnum","CrashToType","Left","_crashToLeft","Right","_crashToRight","Up","_crashToUp","Down","_crashToDown","LeftUpAndRightDown","_crashToLeftUpAndRightDown","LeftDownAndRightUp","_crashToLeftDownAndRightUp","onCrashedContainer","i","crashX","addCrashedContainer","crashY","list","j","one","isInTouch","isSame","isSameType","checkIsInArea","_showContainerLine","changeCurEle","next","rotation","getNextRotation","_hideAllContainerLine","removeSelectList","_removeDeadContainer","_addContainerInMap","logic","isDead","z","down","dropTo","_swapTwoContainer","pos1","pos2","c1","c2","destroy","getOneRandomSweetInfo"],"mappings":"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","file":"lc_layer_container.js","sourceRoot":"../../../../../../../assets/lcGame/scripts/layers/gameArea","sourcesContent":["/**\n * 游戏元素 -- 游戏区域\n *\n */\ncc.Class({\n    extends: tm.GameWapper,\n\n    properties: {\n        _startX: 0, // 初始化x坐标\n        _startY: 0, // 初始化y坐标\n\n        // 容器的\n        _curLevelInfo: null, // 当前地图数据\n        _containerList: null,\n        _chanceLogic: null, // 切换逻辑\n\n        // 线的\n        _lineList: null, // 线\n\n        // creator\n        lineNode: cc.Node,\n        linePrefab: cc.Prefab,\n\n        containerNode: cc.Node,\n        containerPrefab: cc.Prefab,\n    },\n\n    onLoad () {\n        this._super();\n        this._initLine();\n        this._initListen();\n        this._lineList = [];\n        this._containerList = [];\n        this._startX = -this.containerNode.getContentSize().width / 2;\n        this._startY = -(this.containerNode.getContentSize().height - 45) ;\n        this._chanceLogic = this.node.getComponent('lc_logic_chance');\n\n        this._parseInfo();\n    },\n\n    _initListen () {\n        this.register(lc.Event.GameEvent.HideLastLine, this._onHideLastLine, this);\n        this.register(lc.Event.GameEvent.CrashOtherContainer, this._onCrashOtherContainer, this);\n    },\n\n    _initLine () {\n        let line = cc.instantiate(this.linePrefab);\n        line.active = false;\n        this.lineNode.addChild(line);\n        this._line = line.getComponent('lc_game_line');\n    },\n\n    _parseInfo: function () {\n        this._curLevelInfo = this.game.levelMgr.getLevelInfo();\n        this._createContainer();\n\n    },\n\n    /**\n     * 创建容器\n     * @private\n     */\n    _createContainer () {\n        for (let col = 0; col <  this._curLevelInfo.length; col++) {\n            this._lineList[col] = [];\n            this._containerList[col] = [];\n\n            let oneCol = this._curLevelInfo[col];\n            if(oneCol) {\n                for (let raw = 0; raw < oneCol.length; raw ++) {\n                    let info = oneCol[raw];\n                    this._createOneContainer(col, raw, info);\n                }\n            }\n        }\n    },\n\n    _createOneContainer (col, raw, info) {\n        let oneWidth  = 81;\n        let oneHeight = 81;\n\n        let x = this._startX + oneWidth / 2 + oneWidth * col;\n        let y = this._startY + oneHeight * raw;\n\n        // 地图\n        let cLogic = this._addOneContainerBackLogic();\n        cLogic.setPos(cc.v2(x, y), col ,raw);\n        cLogic.setContainer(info);\n\n        // 线\n        let cline = this._addOneLineBackLogic();\n        cline.pos(x, y);\n        cline.hide();\n\n        this._lineList[col][raw] = cline;\n        this._containerList[col][raw] = cLogic;\n    },\n\n    _addOneContainerBackLogic() {\n        let container = cc.instantiate(this.containerPrefab);\n        let mContainer = container.getComponent('lc_game_container');\n        this.containerNode.addChild(container);\n        return mContainer;\n    },\n\n    _addOneLineBackLogic () {\n        let line = cc.instantiate(this.linePrefab);\n        let mLine = line.getComponent('lc_game_line');\n        this.lineNode.addChild(line);\n        return mLine;\n    },\n\n    start () {\n        this._initTouchEvent();\n    },\n\n    /**\n     * 注册触摸事件\n     * @private\n     */\n    _initTouchEvent () {\n        this.node.on(tm.NodeEventType.TOUCH_START, function (event) {\n            this._onTouchStart(event);\n        }, this);\n\n        this.node.on(tm.NodeEventType.TOUCH_MOVE, function (event) {\n            this._onTouchMove(event);\n        }, this);\n\n        this.node.on(tm.NodeEventType.TOUCH_END, function () {\n            this._onTouchFinish();\n        }, this);\n\n        this.node.on(tm.NodeEventType.TOUCH_CANCEL, function () {\n            this._onTouchFinish();\n        }, this);\n    },\n\n    _onTouchStart (event) {\n        let location = event.getLocation();\n        let ele = this._getEleInTouch(location);\n        if(ele && ele.isCanChance()) {\n\n            tm.LOGD(\"logicX\", ele.logicX);\n            tm.LOGD(\"logicY\", ele.logicY);\n            this._changeCurEle(ele);\n            this._showLineByEle(ele);\n        }\n    },\n\n    /**\n     * 显示线\n     * 设置初始坐标\n     * 确定颜色\n     * @param cell\n     * @private\n     */\n    _showLineByEle (ele) {\n        if(ele) {\n            this._line.show();\n            this._line.setHigh(0);\n            this._line.pos(ele.node.x, ele.node.y) ;\n        }\n    },\n\n    /**\n     * 设置线的高度和旋转\n     * @param ele\n     * @private\n     */\n    _setLineHeightAndRotationByEle (location) {\n        if(location) {\n            let start = cc.v2(this._line.node.x, this._line.node.y);\n            let end = this.containerNode.convertToNodeSpaceAR(location);\n            let dis = end.sub(start).mag();\n\n            //向量差计算,结束点-开始点，向量的指向是朝着结束点\n            let posSub = end.sub(start);\n\n            //向量的角度计算，Math.atan2是获得弧度值，角度 = 弧度/PI*180\n            let angle = Math.atan2(posSub.x, posSub.y) / Math.PI * 180;\n\n            this._line.setRotation(angle);\n            this._line.setHigh(dis);\n        }\n    },\n\n    /**\n     * 隐藏线\n     * @private\n     */\n    _hideLine () {\n        this._line.hide();\n        this._line.setHigh(0);\n    },\n\n    /**\n     * 隐藏最后一个跳线\n     * @private\n     */\n    _onHideLastLine () {\n        let curEle = this._chanceLogic.getCurEle();\n        if(curEle && this._lineList[curEle.logicX] &&\n            this._lineList[curEle.logicX][curEle.logicY]) {\n            let line = this._lineList[curEle.logicX][curEle.logicY];\n            line.hide();\n            this._showLineByEle(curEle);\n        }\n    },\n\n    /**\n     * 撞击其他容器\n     * @private\n     */\n    _onCrashOtherContainer (info) {\n        if(info && info.to && info.count >= 0) {\n            switch (info.to) {\n                case lc.GameEnum.CrashToType.Left:\n                    this._crashToLeft(info);\n                    break;\n\n\n                case lc.GameEnum.CrashToType.Right:\n                    this._crashToRight(info);\n                    break;\n\n                case lc.GameEnum.CrashToType.Up:\n                    this._crashToUp(info);\n                    break;\n\n                case lc.GameEnum.CrashToType.Down:\n                    this._crashToDown(info);\n                    break;\n\n                case lc.GameEnum.CrashToType.LeftUpAndRightDown:\n                    this._crashToLeftUpAndRightDown(info);\n                    break;\n\n                case lc.GameEnum.CrashToType.LeftDownAndRightUp:\n                    this._crashToLeftDownAndRightUp(info);\n                    break;\n            }\n\n            this._chanceLogic.onCrashedContainer();\n        }\n    },\n\n    /**\n     * 向左碰撞\n     * @param info\n     * @private\n     */\n    _crashToLeft (info) {\n        let logicX = info.x;\n        let logicY = info.y;\n        let count = info.count;\n        for (let i = 1; i <= count; i++) {\n            let crashX = logicX - i;\n            if (this._containerList[crashX] && this._containerList[crashX][logicY]) {\n                let container = this._containerList[crashX][logicY];\n                this._chanceLogic.addCrashedContainer(container);\n            }\n        }\n    },\n\n    /**\n     * 向右碰撞\n     * @param info\n     * @private\n     */\n    _crashToRight (info) {\n        let logicX = info.x;\n        let logicY = info.y;\n        let count = info.count;\n        for (let i = 1; i <= count; i++) {\n            let crashX = logicX + i;\n            if (this._containerList[crashX] && this._containerList[crashX][logicY]) {\n                let container = this._containerList[crashX][logicY];\n                this._chanceLogic.addCrashedContainer(container);\n            }\n        }\n    },\n\n    /**\n     * 向上碰撞\n     * @param info\n     * @private\n     */\n    _crashToUp (info) {\n        let logicX = info.x;\n        let logicY = info.y;\n        let count = info.count;\n        for (let i = 1; i <= count; i++) {\n            let crashY = logicY + i;\n            if (this._containerList[logicX] && this._containerList[logicX][crashY]) {\n                let container = this._containerList[logicX][crashY];\n                this._chanceLogic.addCrashedContainer(container);\n            }\n        }\n    },\n\n    /**\n     * 向下碰撞\n     * @param info\n     * @private\n     */\n    _crashToDown (info) {\n        let logicX = info.x;\n        let logicY = info.y;\n        let count = info.count;\n        for (let i = 1; i <= count; i++) {\n            let crashY = logicY - i;\n            if (this._containerList[logicX] && this._containerList[logicX][crashY]) {\n                let container = this._containerList[logicX][crashY];\n                this._chanceLogic.addCrashedContainer(container);\n            }\n        }\n    },\n\n    /**\n     * 左上右下\n     *   *\n     *     *\n     *       *\n     *         *\n     *\n     * @param info\n     * @private\n     */\n    _crashToLeftUpAndRightDown (info) {\n        let logicX = info.x;\n        let logicY = info.y;\n        let count = info.count;\n\n        // 先搜索左上\n        for (let i = 1; i <= count; i++) {\n            let crashX = logicX - i;\n            let crashY = logicY + i;\n            if (this._containerList[crashX] && this._containerList[crashX][crashY]) {\n                let container = this._containerList[crashX][crashY];\n                this._chanceLogic.addCrashedContainer(container);\n            }\n        }\n\n        // 再搜索右下\n        for (let i = 1; i <= count; i++) {\n            let crashX = logicX + i;\n            let crashY = logicY - i;\n            if (this._containerList[crashX] && this._containerList[crashX][crashY]) {\n                let container = this._containerList[crashX][crashY];\n                this._chanceLogic.addCrashedContainer(container);\n            }\n        }\n    },\n\n\n    /**\n     * 左下右上\n     *         *\n     *       *\n     *     *\n     *   *\n     *\n     * @param info\n     * @private\n     */\n    _crashToLeftDownAndRightUp (info) {\n        let logicX = info.x;\n        let logicY = info.y;\n        let count = info.count;\n\n        // 先搜索左下\n        for (let i = 1; i <= count; i++) {\n            let crashX = logicX - i;\n            let crashY = logicY - i;\n            if (this._containerList[crashX] && this._containerList[crashX][crashY]) {\n                let container = this._containerList[crashX][crashY];\n                this._chanceLogic.addCrashedContainer(container);\n            }\n        }\n\n        // 再搜索右上\n        for (let i = 1; i <= count; i++) {\n            let crashX = logicX + i;\n            let crashY = logicY + i;\n            if (this._containerList[crashX] && this._containerList[crashX][crashY]) {\n                let container = this._containerList[crashX][crashY];\n                this._chanceLogic.addCrashedContainer(container);\n            }\n        }\n    },\n\n    /**\n     * 获取当前被点击的元素\n     * @private\n     */\n    _getEleInTouch (location) {\n        let list = this._containerList;\n        for (let i = 0; i < list.length; i++) {\n            let col = list[i];\n            for (let j = 0; j < col.length; j++) {\n                let one = col[j];\n                if(one.isInTouch(location)) {\n                    return one;\n                }\n\n            }\n        }\n\n        return null;\n    },\n\n    _onTouchMove (event) {\n        let location = event.getLocation();\n        this._setLineHeightAndRotationByEle(location);\n        let ele = this._getEleInTouch(location);\n        if(ele && ele.isCanChance()) {\n            // 如果是同一个糖果\n            if(this._chanceLogic.isSame(ele)) {\n                return;\n            }\n\n            // 如果不是同一种类型\n            if(!this._chanceLogic.isSameType(ele)) {\n                return;\n            }\n\n            // 如果不再区域内\n            if(!this._chanceLogic.checkIsInArea(ele)) {\n                return;\n            }\n\n            this._showContainerLine(ele);\n            this._chanceLogic.changeCurEle(ele);\n            this._showLineByEle(ele);\n        }\n    },\n\n    /**\n     * 显示容器的线\n     * @private\n     */\n    _showContainerLine (next) {\n        let curEle = this._chanceLogic.getCurEle();\n        if(curEle && this._lineList[curEle.logicX] &&\n            this._lineList[curEle.logicX][curEle.logicY]) {\n            let line = this._lineList[curEle.logicX][curEle.logicY];\n            let rotation = curEle.getNextRotation(next);\n            line.show();\n            line.setRotation(rotation);\n        }\n    },\n\n    _onTouchFinish () {\n        this._hideLine();\n        this._hideAllContainerLine();\n        this._chanceLogic.removeSelectList();\n        this._removeDeadContainer();\n        this._addContainerInMap();\n    },\n\n    /**\n     * 隐藏所有线\n     * @private\n     */\n    _hideAllContainerLine () {\n        let list = this._lineList;\n        for (let i = 0; i < list.length; i++) {\n            let col = list[i];\n            for (let j = 0; j < col.length; j++) {\n                let line = col[j];\n                line.hide();\n            }\n        }\n    },\n\n    /**\n     * 移除死亡的容器\n     * @private\n     */\n    _removeDeadContainer () {\n        let list = this._containerList;\n        for (let i = 0; i < list.length; i++) {\n            let col = list[i];\n            for (let j = 0; j < col.length; j++) {\n                let logic = col[j];\n                let isDead = logic.isDead();\n\n                if(isDead) {\n                    continue;\n                }\n\n                let dis = 0;\n                let z = j-1;\n                while(z >= 0){\n                    let down = col[z];\n                    if(down.isDead()){\n                        ++dis;\n                    }\n\n                    --z;\n                }\n\n                if(dis > 0){\n                    logic.dropTo(j - dis, 0, dis * 81);\n                    this._swapTwoContainer(cc.v2(i, j), cc.v2(i, j - dis));\n                }\n            }\n        }\n    },\n\n    /**\n     * 交换两个游戏的容器坐标\n     * @param pos1\n     * @param pos2\n     * @private\n     */\n    _swapTwoContainer (pos1, pos2){\n        let c1 = this._containerList[pos1.x][pos1.y];\n        let c2 = this._containerList[pos2.x][pos2.y];\n\n        if(c1 && c2) {\n            this._containerList[pos1.x][pos1.y] = c2;\n            this._containerList[pos2.x][pos2.y] = c1;\n        }\n    },\n\n    /**\n     * 向地图中加入到地图中\n     * @private\n     */\n    _addContainerInMap () {\n        let list = this._containerList;\n        for (let i = 0; i < list.length; i++) {\n            let col = list[i];\n            for (let j = 0; j < col.length; j++) {\n\n                let logic = col[j];\n                let isDead = logic.isDead();\n                if(isDead) {\n                    logic.destroy();\n                    logic = null;\n\n                    let info = this.game.levelMgr.getOneRandomSweetInfo();\n                    this._createOneContainer(i, j, info);\n                }\n            }\n        }\n    },\n\n    /**\n     * 更换当前cell\n     * @param cell\n     * @private\n     */\n    _changeCurEle (ele) {\n        this._chanceLogic.changeCurEle(ele);\n    },\n\n\n\n\n\n});\n"]}