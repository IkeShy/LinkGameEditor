{"version":3,"sources":["lc_layer_game_area_copy.js"],"names":["cc","Class","extends","tm","GameWapper","properties","m_col","m_raw","_startX","_startY","_m_colSize","_m_rawSize","_m_currGameEle","_m_eleLineList","_m_gameEleList","_m_isTouchClick","_m_selectGameEleList","_findGameEleList","m_mix_line","m_hintLine","Node","m_gameElePre","Prefab","m_eleLinePre","m_gameLineNode","m_gameAreaBg","m_gameMaskArea","onLoad","_super","getContentSize","width","height","start","_initEleLineList","x","Array","y","line","instantiate","addChild","_createEleLineList","size","oneCol","oneRaw","i","j","logic","getComponent","init","_initGameEleList","ele","_createGameEleList","v2","_initListenGameAreaBgEvent","on","NodeEventType","TOUCH_START","event","onTouchStart","TOUCH_MOVE","onTouchMove","TOUCH_END","onTouchFinish","TOUCH_CANCEL","location","getLocation","gameEle","_isGameEleInTouch","useTool","game","gameMgr","getUseHammerToolFunc","_useHammerToolFunc","_changeCurrGameEle","_changeHintLineColor","cell","push","_cleanSelectGameEleList","length","_cleanUpGameEleList","_addGameEleIntoMap","isAddScore","removeFromParent","isDead","_stopGameEleEffect","_playGameEleEffect","playEffect","stopEffect","_hideHintLine","active","getDead","dis","z","down","downLogic","drop","_swapGameEle","pos1","pos2","gameEle_1","gameEle_2","dead","_createGameEle","_hideFindGameEle","self","forEach","item","index","logicX","logicY","opacity","posx","posy","_refreshHintLine","_isSameGameEle","isGameEleCanRemove","_setGameELeLineActive","end","convertToNodeSpaceAR","sub","mag","posSub","angle","Math","atan2","PI","rotation","find","value","_checkIsSamePos","_popLastGameEle","log","checkSametype","getType","checkAreaIn","_resetHintLineStartPos","color","getColorType","fromHEX","eleA","eleB","flag","logicA","getLogicX","getLogicY","logicB","checkSamePos","pop","newEle","cEle","tEle","lineLogic","getShowDrawLineRotation","showLine","setLineColor","hideLine","_hideAllGameEleHintLine","_removeGameEleFunc","col","list","one","pos","isRemove","_addGameHistory","_calculateSelectGameEle","_addGameEleScore","_subStepCount","saveHistory","score","type","oneEle","trigger","lc","Event","GameEvent","AddScore","SubStepCount"],"mappings":"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","file":"lc_layer_game_area_copy.js","sourceRoot":"../../../../../../../assets/lcGame/scripts/layers/gameArea","sourcesContent":["/**\n * 游戏元素 -- 游戏区域\n *\n */\ncc.Class({\n    extends: tm.GameWapper,\n\n    properties: {\n        m_col: 8,\n        m_raw: 8,\n\n        _startX: 0, // 初始化x坐标\n        _startY: 0, // 初始化y坐标\n\n        _m_colSize: 0,\n        _m_rawSize: 0,\n\n        _m_currGameEle: null, // 当前的游戏元素\n        _m_eleLineList: null, // 元素线列表\n        _m_gameEleList: null, // 游戏元素列表\n\n        _m_isTouchClick: false, // 是否触发点击\n        _m_selectGameEleList: [], // 当前选择的游戏元素列表\n\n        _findGameEleList: [], // 找到的游戏元素列表\n\n        // creator\n        m_mix_line: 3, // 合成需要数量\n        m_hintLine: cc.Node, // 指示线段\n        m_gameElePre: cc.Prefab, // 单个游戏元素\n        m_eleLinePre: cc.Prefab, // 单个元素线\n\n\n        m_gameLineNode:cc.Node, // 划线用的节点\n        m_gameAreaBg: cc.Node, // 游戏区域背景\n        m_gameMaskArea: cc.Node, // 游戏元素存放区域，用于遮罩\n    },\n\n    onLoad () {\n        this._super();\n\n        this._startX = -this.m_gameAreaBg.getContentSize().width / 2;\n        this._startY = -(this.m_gameAreaBg.getContentSize().height - 45) ;\n\n        //this._initEleLineList();\n        //this._initGameEleList();\n        //this._initListenGameAreaBgEvent();\n    },\n\n    start () {\n        //this._createEleLineList();\n        //this._createGameEleList();\n    },\n\n    /**\n     * 初始化元素线list\n     * @private\n     */\n    _initEleLineList: function () {\n        this._m_eleLineList = [];\n\n        for(let x = 0; x < this.m_col; x++){\n            this._m_eleLineList[x]= new Array();\n\n            for(let y=0; y < this.m_raw; y++){\n                let line = cc.instantiate(this.m_eleLinePre);\n                this._m_eleLineList[x][y] = line;\n                this.m_gameLineNode.addChild(line);\n            }\n        }\n    },\n\n    /**\n     * 创建元素线\n     * @private\n     */\n    _createEleLineList: function () {\n        let size = this.m_gameAreaBg.getContentSize();\n        let oneCol = size.width / this.m_col;\n        let oneRaw = size.height / this.m_raw;\n\n        for(let i=0; i< this.m_col; i++){\n            for(let j=0; j<this.m_raw; j++){\n\n                let x = this._startX + oneCol / 2 + oneCol * i;\n                let y = this._startY + oneRaw * j;\n                if(this._m_eleLineList[i] && this._m_eleLineList[i][j]) {\n                    let line = this._m_eleLineList[i][j];\n                    let logic = line.getComponent('lc_game_line');\n                    logic.init(x, y);\n                }\n            }\n        }\n    },\n\n    /**\n     * 初始化元素list\n     * @private\n     */\n    _initGameEleList: function () {\n        this._m_gameEleList = [];\n\n        for(let x = 0; x < this.m_col; x++){\n            this._m_gameEleList[x]= new Array();\n\n            for(let y=0; y < this.m_raw; y++){\n                let ele = cc.instantiate(this.m_gameElePre);\n                this.m_gameMaskArea.addChild(ele);\n                this._m_gameEleList[x][y] = ele;\n            }\n        }\n    },\n\n    /**\n     * 创建游戏元素\n     * @private\n     */\n    _createGameEleList: function () {\n        let size = this.m_gameAreaBg.getContentSize();\n        this._m_colSize = size.width / this.m_col;\n        this._m_rawSize = size.height / this.m_raw;\n\n        for(let i = 0; i < this.m_col; i++){\n            for(let j = 0; j < this.m_raw; j++){\n                let x = this._startX + this._m_colSize / 2 + this._m_colSize * i;\n                let y = this._startY + this._m_rawSize * j;\n\n                if(this._m_gameEleList[i] && this._m_gameEleList[i][j]) {\n                    let ele = this._m_gameEleList[i][j];\n                    let logic = ele.getComponent('lc_game_ele');\n                    logic.init(cc.v2(x, y), i ,j);\n                }\n            }\n        }\n    },\n\n    /**\n     * 监听游戏背景消息\n     * @private\n     */\n    _initListenGameAreaBgEvent () {\n        this.m_gameAreaBg.on(tm.NodeEventType.TOUCH_START, function ( event ) {\n            this._m_isTouchClick = true;\n            this.onTouchStart(event);\n        }, this);\n\n        this.m_gameAreaBg.on(tm.NodeEventType.TOUCH_MOVE, function ( event ) {\n            this.onTouchMove(event);\n        }, this);\n\n        this.m_gameAreaBg.on(tm.NodeEventType.TOUCH_END, function ( event ) {\n            this.onTouchFinish();\n        }, this);\n\n        this.m_gameAreaBg.on(tm.NodeEventType.TOUCH_CANCEL, function ( event ) {\n            this.onTouchFinish();\n        }, this);\n    },\n\n    /**\n     * 点击开始\n     * @param event\n     */\n    onTouchStart: function (event) {\n        if(this._m_isTouchClick) {\n            let location = event.getLocation();\n            let gameEle = this._isGameEleInTouch(location);\n\n            if(gameEle) {\n                let useTool = this.game.gameMgr.getUseHammerToolFunc();\n                if(useTool) {\n                    this._useHammerToolFunc(gameEle);\n                } else {\n                    this._changeCurrGameEle(gameEle);\n                    this._changeHintLineColor(gameEle);\n                }\n            }\n        }\n    },\n\n    /**\n     * 使用锤子道具\n     * @private\n     */\n    _useHammerToolFunc: function (cell) {\n        if(cell) {\n            this._m_selectGameEleList.push(cell);\n\n            this._cleanSelectGameEleList(true);\n            this._m_selectGameEleList.length = 0;\n\n            this._cleanUpGameEleList();\n            this._addGameEleIntoMap();\n        }\n    },\n\n    /**\n     *\n     * @private\n     */\n    _cleanSelectGameEleList: function (isAddScore) {\n        // 删除网格\n        for (let i = 0; i < this._m_selectGameEleList.length; i++) {\n            let gameEle = this._m_selectGameEleList[i];\n            if(gameEle) {\n                let logic = gameEle.getComponent('lc_game_ele');\n\n                if (isAddScore) {\n                    gameEle.removeFromParent(true);\n                    logic.isDead(true);\n                } else {\n                    this._stopGameEleEffect(gameEle);\n                }\n            }\n        }\n    },\n\n    /**\n     *  显示格子的特效\n     * @param cell\n     * @private\n     */\n    _playGameEleEffect (ele) {\n        let logic = ele.getComponent('lc_game_ele');\n        if(logic) {\n            logic.playEffect();\n        }\n    },\n\n\n    /**\n     * 停止格子的特效\n     * @param cell\n     * @private\n     */\n    _stopGameEleEffect : function (ele) {\n        let logic = ele.getComponent('lc_game_ele');\n        if(logic) {\n            logic.stopEffect();\n        }\n    },\n\n    /**\n     * 隐藏指示线\n     * @private\n     */\n    _hideHintLine () {\n        this.m_hintLine.height = 0;\n        this.m_hintLine.active = false;\n    },\n\n    /**\n     * 清理游戏元素的队列\n     * @private\n     */\n    _cleanUpGameEleList: function () {\n        for(let i = 0; i < this._m_gameEleList.length; i++) {\n            for(let j = 0; j < this._m_gameEleList[i].length; j++){\n\n                let gameEle = this._m_gameEleList[i][j];\n                let logic = gameEle.getComponent('lc_game_ele');\n                let isDead = logic.getDead();\n\n                if(isDead){\n                    continue;\n                }\n\n                let dis = 0;\n                let z = j-1;\n\n                while(z >= 0){\n                    let down = this._m_gameEleList[i][z];\n                    let downLogic = down.getComponent('lc_game_ele');\n\n                    if(downLogic.getDead()){\n                        ++dis;\n                    }\n\n                    --z;\n                }\n\n                if(dis > 0){\n                    logic.drop(0, j - dis, 0, dis * this._m_rawSize);\n                    this._swapGameEle(cc.v2(i, j), cc.v2(i, j - dis));\n                }\n\n            }\n        }\n    },\n\n    /**\n     * 交换两个游戏元素\n     * @param pos1\n     * @param pos2\n     * @private\n     */\n    _swapGameEle (pos1, pos2){\n        let gameEle_1 = this._m_gameEleList[pos1.x][pos1.y];\n        let gameEle_2 = this._m_gameEleList[pos2.x][pos2.y];\n\n        if(gameEle_1 && gameEle_2) {\n            this._m_gameEleList[pos1.x][pos1.y] = gameEle_2;\n            this._m_gameEleList[pos2.x][pos2.y] = gameEle_1;\n        }\n    },\n\n    /**\n     * 向地图中加入到地图中\n     * @private\n     */\n    _addGameEleIntoMap () {\n        for(let i = 0; i < this._m_gameEleList.length; i++){\n            for(let j = 0; j < this._m_gameEleList[i].length; j++){\n                let gameEle = this._m_gameEleList[i][j];\n                if(gameEle) {\n                    let logic = gameEle.getComponent('lc_game_ele');\n                    let dead = logic.getDead();\n\n                    if (dead) {\n                        this._m_gameEleList[i][j].removeFromParent(true);\n                        this._m_gameEleList[i][j] = null;\n\n                        //创建一个并飞到该地方\n                        let x = this._startX + this._m_colSize / 2 + this._m_colSize * i;\n                        let y = this._startY + this._m_rawSize * j\n                        let gameEle = this._createGameEle(x, y, i, j);\n\n                        this._m_gameEleList[i][j] = gameEle;\n                    }\n                }\n            }\n        }\n    },\n\n    /**\n     * 隐藏道具找到的格子\n     * @private\n     */\n    _hideFindGameEle () {\n        let self = this;\n        this._findGameEleList.forEach(function (item, index) {\n            let logicX = item.logicX;\n            let logicY = item.logicY;\n\n            if(self._m_gameEleList[logicX] && self._m_gameEleList[logicX][logicY]) {\n                let gameEle = self._m_gameEleList[logicX][logicY];\n                if (gameEle) {\n                    gameEle.opacity = 255;\n                }\n            }\n        });\n\n        this._findGameEleList.length = 0;\n    },\n\n    /**\n     * 创建游戏元素\n     * @param posx\n     * @param posy\n     * @param x\n     * @param y\n     * @returns {Node}\n     * @private\n     */\n    _createGameEle: function (posx, posy, x, y) {\n        let ele = cc.instantiate(this.m_gameElePre);\n        let logic = ele.getComponent('lc_game_ele');\n\n        this.m_gameMaskArea.addChild(ele);\n        logic.init(cc.v2(posx, posy), x ,y);\n\n        return ele;\n    },\n\n    /**\n     * 点击移动\n     * @param event\n     */\n    onTouchMove: function (event) {\n        let location = event.getLocation();\n        this._refreshHintLine(location);\n\n        let gameEle = this._isGameEleInTouch(location);\n        if(gameEle) {\n            // 是否和队列中相同\n            if(this._isSameGameEle(gameEle)) {\n                return;\n            }\n\n            // 游戏元素是否可以移除\n            if(this.isGameEleCanRemove(gameEle)){\n                return;\n            }\n\n            if(this._m_currGameEle){\n                this._setGameELeLineActive(this._m_currGameEle, gameEle, true);\n                this._changeCurrGameEle(gameEle);\n            }\n        }\n    },\n\n    /**\n     * 刷新指示线长度\n     * @private\n     */\n    _refreshHintLine: function (location) {\n        if(this.m_hintLine) {\n            let start = cc.v2(this.m_hintLine.x, this.m_hintLine.y);\n            let end = this.m_gameAreaBg.convertToNodeSpaceAR(location);\n            let dis = end.sub(start).mag();\n\n            // 向量差计算,结束点-开始点，向量的指向是朝着结束点\n            let posSub = end.sub(start);\n\n            //向量的角度计算，Math.atan2是获得弧度值，角度 = 弧度/PI*180\n            let angle = Math.atan2(posSub.x, posSub.y) / Math.PI * 180;\n\n            this.m_hintLine.rotation = angle;\n            this.m_hintLine.height = dis;\n        }\n    },\n\n    /**\n     * 是否和已有列表中的最后一个是相同的\n     * @param gameEle\n     * @private\n     */\n    _isSameGameEle: function (gameEle) {\n        if(this._m_selectGameEleList.find(function(value){\n            return value === gameEle;\n        })){\n            if(this._m_selectGameEleList.length > 1) {\n                let ele = this._m_selectGameEleList[this._m_selectGameEleList.length - 2];\n                if(ele) {\n                    if (this._checkIsSamePos(ele, gameEle)) {\n                        this._popLastGameEle();\n                    }\n                }\n            }\n\n            return true;\n        }\n\n        return false;\n    },\n\n    /**\n     * 这个游戏原始是否可以删掉\n     */\n    isGameEleCanRemove: function (gameEle){\n        if(!this._m_currGameEle){\n            cc.log(\"还没开始选择到格子\");\n            return false;\n        }\n\n        if(!gameEle.getComponent('lc_game_ele').checkSametype(this._m_currGameEle.getComponent('lc_game_ele').getType())){\n            cc.log(\"选中的格子类型不同\");\n            return true;\n        }\n\n        if(!gameEle.getComponent('lc_game_ele').checkAreaIn(this._m_currGameEle)){\n            cc.log(\"选中的格子不在上一个元素的周围\");\n            return true;\n        }\n\n        return false;\n    },\n\n    /**\n     * 更换当前cell\n     * @param cell\n     * @private\n     */\n    _changeCurrGameEle (gameEle) {\n        this._playGameEleEffect(gameEle);\n        this._resetHintLineStartPos(gameEle);\n\n        this._m_currGameEle = gameEle;\n\n\n        this._m_selectGameEleList.push(gameEle);\n    },\n\n    /**\n     * 切换画线颜色\n     * @param cell\n     * @private\n     */\n    _changeHintLineColor (gameEle) {\n        let logic = gameEle.getComponent('lc_game_ele');\n        let color = logic.getColorType();\n        this.m_hintLine.color = cc.color(0, 0, 0).fromHEX(color);\n    },\n\n    /**\n     * 检测是否在同一坐标下\n     * @private\n     */\n    _checkIsSamePos: function (eleA, eleB) {\n        let flag = false;\n        if(eleA && eleB) {\n            let logicA = eleA.getComponent('lc_game_ele');\n            let logicX = logicA.getLogicX();\n            let logicY = logicA.getLogicY();\n\n            let logicB = eleB.getComponent('lc_game_ele');\n            flag = logicB.checkSamePos(logicX, logicY);\n        }\n\n        return flag;\n    },\n\n    /**\n     * 弹出最后一个游戏元素\n     * @private\n     */\n    _popLastGameEle: function () {\n        let gameEle = this._m_selectGameEleList.pop();\n        if(gameEle) {\n            this._stopGameEleEffect(gameEle);\n        }\n\n        let newEle = this._m_selectGameEleList[this._m_selectGameEleList.length - 1];\n        if(newEle) {\n            this._m_currGameEle = newEle;\n            this._setGameELeLineActive(this._m_currGameEle, null, false);\n            this._resetHintLineStartPos(this._m_currGameEle);\n        }\n    },\n\n    /**\n     * 设置游戏元素线的可见度\n     * @private\n     */\n    _setGameELeLineActive: function (cEle, tEle, flag) {\n        let logic = cEle.getComponent('lc_game_ele');\n        let logicX = logic.getLogicX();\n        let logicY = logic.getLogicY();\n\n        if(this._m_eleLineList[logicX] &&  this._m_eleLineList[logicX][logicY]) {\n            let line = this._m_eleLineList[logicX][logicY];\n            if(line) {\n                let lineLogic = line.getComponent('lc_game_line');\n                if(flag) {\n                    let rotation = logic.getShowDrawLineRotation(tEle);\n                    let color = logic.getColorType();\n\n                    lineLogic.showLine(rotation);\n                    lineLogic.setLineColor(color);\n                } else {\n                    lineLogic.hideLine();\n                }\n            }\n        }\n    },\n\n    /**\n     * 重制画线提示坐标\n     * @private\n     */\n    _resetHintLineStartPos: function (gameEle) {\n        this.m_hintLine.x = gameEle.x;\n        this.m_hintLine.y = gameEle.y;\n        this.m_hintLine.height = 0;\n        this.m_hintLine.active = true;\n    },\n\n    /**\n     * 点击完成\n     * @param event\n     */\n    onTouchFinish: function (event) {\n        this._hideHintLine();\n        this._hideAllGameEleHintLine();\n        this._removeGameEleFunc();\n\n        this._m_isTouchClick = false;\n        this._m_currGameEle = null;\n        this._m_selectGameEleList.length = 0;\n\n        this._cleanUpGameEleList();\n        this._addGameEleIntoMap();\n        this._hideFindGameEle();\n    },\n\n    /**\n     * 隐藏所有格子的画线\n     * @private\n     */\n    _hideAllGameEleHintLine: function () {\n        for(let i = 0; i < this._m_eleLineList.length; i++) {\n            let col = this._m_eleLineList[i];\n\n            for (let j = 0; j < col.length; j++) {\n                let line = col[j];\n                if(line) {\n                    let logic = line.getComponent('lc_game_line');\n                    logic.hideLine();\n                }\n            }\n        }\n    },\n\n    /**\n     * 当前点击是否在元素上\n     * @private\n     */\n    _isGameEleInTouch (location) {\n        let list = this._m_gameEleList;\n        for (let i = 0; i < list.length; i++) {\n\n            let col = list[i];\n            for (let j = 0; j < col.length; j++) {\n                let one = col[j];\n                let pos = one.convertToNodeSpaceAR(location);\n                if (pos.x > -one.width / 2 && pos.x < one.width / 2 && pos.y < one.height && pos.y > -one.height) {\n                    return one;\n                }\n            }\n        }\n\n        return null;\n    },\n\n    /**\n     * 移除选中网格\n     * @private\n     */\n    _removeGameEleFunc: function () {\n        let isRemove = this._m_selectGameEleList.length >= this.m_mix_line ? true : false;\n        if(isRemove) {\n\n            // 清理前记录当前数据\n            this._addGameHistory();\n\n            // 计算选择网格\n            this._calculateSelectGameEle(isRemove);\n\n            // 增加分数\n            this._addGameEleScore();\n\n            // 减少步数\n            this._subStepCount();\n        }\n    },\n\n    /**\n     * 保存历史记录\n     * @private\n     */\n    _addGameHistory: function () {\n        this.game.gameMgr.saveHistory(this);\n    },\n\n    /**\n     * 计算选择网格\n     * @private\n     */\n    _calculateSelectGameEle: function (isRemove) {\n        // 删除网格\n        for (let i = 0; i < this._m_selectGameEleList.length; i++) {\n            let gameEle = this._m_selectGameEleList[i];\n            let logic = gameEle.getComponent('lc_game_ele');\n\n            if(isRemove){\n                gameEle.removeFromParent(true);\n                logic.isDead(true);\n            }else{\n                this._stopGameEleEffect(gameEle);\n            }\n        }\n    },\n\n    /**\n     * 计算游戏元素分数\n     * @private\n     */\n    _addGameEleScore: function () {\n        let score = 0;\n        let type = null;\n\n        this._m_selectGameEleList.forEach(function (oneEle, index) {\n            if(oneEle) {\n                let logic = oneEle.getComponent('lc_game_ele');\n\n                type = logic.getType();\n            }\n        });\n\n        if(type >= 0) {\n            this.trigger(lc.Event.GameEvent.AddScore, {\"type\": type, \"score\": score});\n        }\n    },\n\n    /**\n     * 减少步数\n     * @private\n     */\n    _subStepCount: function () {\n        this.trigger(lc.Event.GameEvent.SubStepCount, {\"count\": 1});\n\n    },\n\n\n});\n"]}