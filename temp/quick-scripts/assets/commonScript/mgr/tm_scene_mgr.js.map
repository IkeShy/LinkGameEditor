{"version":3,"sources":["tm_scene_mgr.js"],"names":["window","tm","sceneMgr","_curSceneName","_state","preloadScene","name","cb","self","notifierCenter","trigger","Event","EVT_POP_COMMON_LOADING_EFFECT","cc","director","error","asset","resetOnProgress","loadScene","loadSceneFail","customPreloadScene","bind","loader","onProgress","destroy","_curScene"],"mappings":";;;;;;AAAA;;;;;;AAMAA,OAAOC,EAAP,GAAYD,OAAOC,EAAP,IAAa,EAAzB;;AAEAA,GAAGC,QAAH,GAAc;;AAEVC,mBAAgB,IAFN;AAGVC,YAAO,CAAC,CAHE,EAGA;;AAEVC,gBALU,wBAKGC,IALH,EAKSC,EALT,EAKY;AAClB,YAAG,KAAKH,MAAL,IAAe,CAAlB,EAAoB;AAChB;AACH;;AAED,aAAKD,aAAL,GAAqBG,IAArB;AACA,aAAKF,MAAL,GAAc,CAAd;;AAEA,YAAII,OAAO,IAAX;;AAEAP,WAAGQ,cAAH,CAAkBC,OAAlB,CAA0BT,GAAGU,KAAH,CAASC,6BAAnC,EAAkE,IAAlE;AACAC,WAAGC,QAAH,CAAYT,YAAZ,CAAyBC,IAAzB,EAA+B,IAA/B,EAAqC,UAASS,KAAT,EAAgBC,KAAhB,EAAsB;AACvDf,eAAGQ,cAAH,CAAkBC,OAAlB,CAA0BT,GAAGU,KAAH,CAASC,6BAAnC,EAAkE,KAAlE;AACAJ,iBAAKS,eAAL;AACA,gBAAG,CAACF,KAAJ,EAAW;AACPF,mBAAGC,QAAH,CAAYI,SAAZ,CAAsBZ,IAAtB,EAA4B,YAAY;AACnCE,yBAAKJ,MAAL,GAAc,CAAd;AACDG,0BAAMA,GAAGQ,KAAH,EAAUC,KAAV,CAAN;AACF,iBAHF;AAIH,aALD,MAKO;AACHR,qBAAKW,aAAL;AACH;AACJ,SAXD;AAYH,KA5BS;AA8BVC,sBA9BU,8BA8BSd,IA9BT,EA8BeC,EA9Bf,EA8BkB;AACxB,YAAG,KAAKH,MAAL,IAAe,CAAlB,EAAoB;AAChB;AACH;;AAED,aAAKD,aAAL,GAAqBG,IAArB;AACA,aAAKF,MAAL,GAAc,CAAd;;AAEA,YAAII,OAAO,IAAX;AACAK,WAAGC,QAAH,CAAYT,YAAZ,CAAyBC,IAAzB,EAA+B,IAA/B,EAAqC,UAAUS,KAAV,EAAiBC,KAAjB,EAAwB;AACzDR,iBAAKS,eAAL;AACA,gBAAG,CAACF,KAAJ,EAAW;AACPP,qBAAKJ,MAAL,GAAc,CAAd;AACAG,sBAAMA,GAAGQ,KAAH,EAAUC,KAAV,CAAN;AACH;AACJ,SAND,EAMG,KAAKG,aAAL,CAAmBE,IAAnB,CAAwB,IAAxB,CANH;AAOH,KA9CS;AAgDVJ,mBAhDU,6BAgDO;AACbJ,WAAGS,MAAH,CAAUC,UAAV,GAAuB,IAAvB;AACH,KAlDS;AAoDVJ,iBApDU,yBAoDIJ,KApDJ,EAoDWC,KApDX,EAoDiB;AACvB,aAAKC,eAAL;AACA,aAAKb,MAAL,GAAc,CAAd;AACH,KAvDS;;;AAyDVoB,aAAQ,mBAAU;AACd,aAAKC,SAAL,GAAiB,IAAjB;AACH;AA3DS,CAAd","file":"tm_scene_mgr.js","sourceRoot":"../../../../../assets/commonScript/mgr","sourcesContent":["/**\n *\n * 内容: 场景管理器\n *\n */\n\nwindow.tm = window.tm || {};\n\ntm.sceneMgr = {\n\n    _curSceneName : null,\n    _state:-1,//1:开始加载 2：加载完成, 3:加载失败\n\n    preloadScene(name, cb){\n        if(this._state == 1){\n            return;\n        }\n\n        this._curSceneName = name;\n        this._state = 1;\n\n        let self = this;\n\n        tm.notifierCenter.trigger(tm.Event.EVT_POP_COMMON_LOADING_EFFECT, true);\n        cc.director.preloadScene(name, null, function(error, asset){\n            tm.notifierCenter.trigger(tm.Event.EVT_POP_COMMON_LOADING_EFFECT, false);\n            self.resetOnProgress();\n            if(!error) {\n                cc.director.loadScene(name, function () {\n                     self._state = 2;\n                    cb && cb(error, asset);\n                 });\n            } else {\n                self.loadSceneFail();\n            }\n        });\n    },\n\n    customPreloadScene(name, cb){\n        if(this._state == 1){\n            return;\n        }\n\n        this._curSceneName = name;\n        this._state = 1;\n\n        var self = this;\n        cc.director.preloadScene(name, null, function (error, asset) {\n            self.resetOnProgress();\n            if(!error) {\n                self._state = 2;\n                cb && cb(error, asset);\n            }\n        }, this.loadSceneFail.bind(this));\n    },\n\n    resetOnProgress(){\n        cc.loader.onProgress = null;\n    },\n\n    loadSceneFail(error, asset){\n        this.resetOnProgress();\n        this._state = 3;\n    },\n\n    destroy:function(){\n        this._curScene = null;\n    }\n};"]}