{"version":3,"sources":["tm_sound_core.js"],"names":["window","tm","SoundCore","cc","Class","_muteFlag","m_musicId","m_musicClip","m_effectVal","m_id2Effect","ctor","notifierCenter","register","Event","EVT_CHANGE_BG_MUSIC_VAL","_onChangeBgmVal","EVT_CHANGE_EFFECT_VAL","_onChangeEffectVal","val","_setVolume","id","audioEngine","setVolume","_setEffectVolume","i","length","one","playMusic","clip","bLoop","undefined","stopMusic","play","isMute","playEffect","loop","effectId","push","playWithCb","path","cb","setFinishCallback","stop","pauseMusic","pause","resumeMusic","resume","setMute","mute","stopAll"],"mappings":";;;;;;AAAA;;;;;;AAOAA,OAAOC,EAAP,GAAYD,OAAOC,EAAP,IAAa,EAAzB;;AAGAA,GAAGC,SAAH,GAAeC,GAAGC,KAAH,CAAS;AACpBC,eAAW,KADS,EACD;;AAEnBC,eAAW,IAHS,EAGH;AACjBC,iBAAa,IAJO,EAID;;AAEnBC,iBAAa,IANO,EAMD;AACnBC,iBAAa,IAPO;;AASpBC,UAAM,gBAAY;AACd,aAAKL,SAAL,GAAiB,KAAjB;AACA,aAAKG,WAAL,GAAmB,CAAnB;AACA,aAAKC,WAAL,GAAmB,EAAnB;;AAEAR,WAAGU,cAAH,CAAkBC,QAAlB,CAA2BX,GAAGY,KAAH,CAASC,uBAApC,EAA6D,KAAKC,eAAlE,EAAmF,IAAnF;AACAd,WAAGU,cAAH,CAAkBC,QAAlB,CAA2BX,GAAGY,KAAH,CAASG,qBAApC,EAA2D,KAAKC,kBAAhE,EAAoF,IAApF;AACH,KAhBmB;;AAkBpB;;;;AAIAF,mBAtBoB,2BAsBHG,GAtBG,EAsBE;AAClB,YAAG,KAAKZ,SAAR,EAAmB;AACf,iBAAKa,UAAL,CAAgB,KAAKb,SAArB,EAAgCY,GAAhC;AACH;AACJ,KA1BmB;;;AA4BpB;;;;;AAKAC,gBAAY,oBAAUC,EAAV,EAAcF,GAAd,EAAmB;AAC3B,YAAGA,QAAQ,EAAR,IAAcA,OAAM,IAAvB,EAA4B;AACxB,mBAAO,KAAP;AACH;;AAED,YAAGA,MAAM,CAAT,EAAYA,MAAM,CAAN;AACZ,YAAGA,MAAM,CAAT,EAAYA,MAAM,CAAN;;AAEZf,WAAGkB,WAAH,CAAeC,SAAf,CAAyBF,EAAzB,EAA6BF,GAA7B;AACH,KA1CmB;;AA4CpB;;;;AAIAD,sBAhDoB,8BAgDAC,GAhDA,EAgDK;AACrB,aAAKK,gBAAL,CAAsBL,GAAtB;AACH,KAlDmB;;;AAoDpB;;;;;AAKAK,sBAAkB,0BAAUL,GAAV,EAAe;AAC7B,YAAGA,MAAM,CAAT,EAAYA,MAAM,CAAN;AACZ,YAAGA,MAAM,CAAT,EAAYA,MAAM,CAAN;;AAEZ,aAAKV,WAAL,GAAmBU,GAAnB;;AAEA,aAAK,IAAIM,IAAI,CAAb,EAAgBA,IAAI,KAAKf,WAAL,CAAiBgB,MAArC,EAA6CD,GAA7C,EAAkD;AAC9C,gBAAIE,MAAM,KAAKjB,WAAL,CAAiBe,CAAjB,CAAV;AACA,gBAAGE,OAAO,CAAV,EAAa;AACTvB,mBAAGkB,WAAH,CAAeC,SAAf,CAAyBI,GAAzB,EAA8BR,GAA9B;AACH;AACJ;AACJ,KArEmB;;AAuEpBS,aAvEoB,qBAuETC,IAvES,EAuEHC,KAvEG,EAuEI;AACpB,YAAI,KAAKxB,SAAT,EAAoB;AAChB;AACH;;AAED,YAAIuB,QAAQE,SAAR,IAAqBF,QAAQ,IAAjC,EAAuC;AACnC,iBAAKrB,WAAL,GAAmBqB,IAAnB;AACH;AACD,YAAIC,UAAUC,SAAV,IAAuBD,UAAU,IAArC,EAA2C;AACvCA,oBAAQ,KAAR;AACH;;AAED;AACA,aAAKE,SAAL;AACA,aAAKzB,SAAL,GAAiBH,GAAGkB,WAAH,CAAeW,IAAf,CAAoB,KAAKzB,WAAzB,EAAsCsB,KAAtC,EAA6C,CAA7C,CAAjB;AACA,eAAO,KAAKvB,SAAZ;AACH,KAvFmB;AAyFpB2B,UAzFoB,oBAyFZ;AACJ,eAAO,KAAK5B,SAAZ;AACH,KA3FmB;AA6FpB6B,cA7FoB,sBA6FRN,IA7FQ,EA6FFO,IA7FE,EA6FI;AACpB,YAAI,KAAK9B,SAAT,EAAoB;AAChB;AACH;;AAED,YAAI8B,SAASL,SAAT,IAAsBK,SAAS,IAAnC,EAAyC;AACrCA,mBAAO,KAAP;AACH;;AAED,YAAIC,WAAWjC,GAAGkB,WAAH,CAAeW,IAAf,CAAoBJ,IAApB,EAA0BO,IAA1B,EAAgC,KAAK3B,WAArC,CAAf;;AAEA;AACA,YAAG2B,IAAH,EAAS;AACL,iBAAK1B,WAAL,CAAiB4B,IAAjB,CAAsBD,QAAtB;AACH;;AAED,eAAOA,QAAP;AACH,KA9GmB;AAgHpBE,cAhHoB,sBAgHTC,IAhHS,EAgHHV,KAhHG,EAgHIW,EAhHJ,EAgHO;AACvB,YAAI,KAAKnC,SAAT,EAAoB;AAChB;AACH;;AAEDwB,gBAAQ,OAAOA,KAAP,KAAiB,WAAjB,GAA+B,KAA/B,GAAuCA,KAA/C;;AAEA,YAAIT,KAAKjB,GAAGkB,WAAH,CAAeW,IAAf,CAAoBO,IAApB,EAA0BV,KAA1B,CAAT;;AAEA1B,WAAGkB,WAAH,CAAeoB,iBAAf,CAAiCrB,EAAjC,EAAqC,YAAY;AAC7CoB,kBAAIA,GAAGpB,EAAH,CAAJ;AACH,SAFD;;AAIA,eAAOA,EAAP;AACH,KA9HmB;;;AAgIpB;;;AAGAW,aAnIoB,uBAmIP;AACT,YAAI,KAAKzB,SAAL,IAAkBwB,SAAlB,IAA+B,KAAKxB,SAAL,IAAkB,IAArD,EAA2D;AACvDH,eAAGkB,WAAH,CAAeqB,IAAf,CAAoB,KAAKpC,SAAzB;AACA,iBAAKA,SAAL,GAAiB,IAAjB;AACH;AACJ,KAxImB;;;AA0IpB;;;AAGAqC,gBAAY,sBAAW;AACnB,YAAI,KAAKrC,SAAL,IAAkBwB,SAAlB,IAA+B,KAAKxB,SAAL,IAAkB,IAArD,EAA2D;AACvDH,eAAGkB,WAAH,CAAeuB,KAAf,CAAqB,KAAKtC,SAA1B;AACH;AACJ,KAjJmB;;AAmJpB;;;AAGAuC,iBAAa,uBAAW;AACpB,YAAI,KAAKvC,SAAL,IAAkBwB,SAAlB,IAA+B,KAAKxB,SAAL,IAAkB,IAArD,EAA2D;AACvDH,eAAGkB,WAAH,CAAeyB,MAAf,CAAsB,KAAKxC,SAA3B;AACH;AACJ,KA1JmB;;AA4JpByC,WA5JoB,mBA4JXC,IA5JW,EA4JL;AACX,aAAK3C,SAAL,GAAiB,CAAC,CAAC2C,IAAnB;AACH,KA9JmB;;;AAgKpB;;;AAGAC,aAAS,mBAAY;AACjB,aAAK3C,SAAL,GAAiB,IAAjB;AACA,aAAKG,WAAL,CAAiBgB,MAAjB,GAA0B,CAA1B;;AAEAtB,WAAGkB,WAAH,CAAe4B,OAAf;AACH;AAxKmB,CAAT,CAAf","file":"tm_sound_core.js","sourceRoot":"../../../../../assets/commonScript/core","sourcesContent":["/**\n *\n * 内容: 音乐控制\n *\n */\n\n\nwindow.tm = window.tm || {};\n\n\ntm.SoundCore = cc.Class({\n    _muteFlag: false,  // 是否静音\n\n    m_musicId: null, // 当前播放的音乐id\n    m_musicClip: null, // 当前播放的音乐文件\n\n    m_effectVal: null, // 音量\n    m_id2Effect: null,\n\n    ctor: function () {\n        this._muteFlag = false;\n        this.m_effectVal = 1;\n        this.m_id2Effect = [];\n\n        tm.notifierCenter.register(tm.Event.EVT_CHANGE_BG_MUSIC_VAL, this._onChangeBgmVal, this);\n        tm.notifierCenter.register(tm.Event.EVT_CHANGE_EFFECT_VAL, this._onChangeEffectVal, this);\n    },\n\n    /**\n     * 修改背景音量\n     * @private\n     */\n    _onChangeBgmVal (val) {\n        if(this.m_musicId) {\n            this._setVolume(this.m_musicId, val);\n        }\n    },\n\n    /**\n     *  设置背景音量大小\n     * @param id\n     * @param volume\n     */\n    _setVolume: function (id, val) {\n        if(val === \"\" || val ==null){\n            return false;\n        }\n\n        if(val < 0) val = 0;\n        if(val > 1) val = 1;\n\n        cc.audioEngine.setVolume(id, val);\n    },\n\n    /**\n     * 修改特效音量\n     * @private\n     */\n    _onChangeEffectVal (val) {\n        this._setEffectVolume(val);\n    },\n\n    /**\n     *  设置特效音量大小\n     * @param id\n     * @param volume\n     */\n    _setEffectVolume: function (val) {\n        if(val < 0) val = 0;\n        if(val > 1) val = 1;\n\n        this.m_effectVal = val;\n\n        for (let i = 0; i < this.m_id2Effect.length; i++) {\n            let one = this.m_id2Effect[i];\n            if(one >= 0) {\n                cc.audioEngine.setVolume(one, val);\n            }\n        }\n    },\n\n    playMusic (clip, bLoop) {\n        if (this._muteFlag) {\n            return;\n        }\n\n        if (clip != undefined && clip != null) {\n            this.m_musicClip = clip;\n        }\n        if (bLoop === undefined || bLoop === null) {\n            bLoop = false;\n        }\n\n        // 先停止之前播放的音乐\n        this.stopMusic();\n        this.m_musicId = cc.audioEngine.play(this.m_musicClip, bLoop, 1);\n        return this.m_musicId;\n    },\n\n    isMute(){\n        return this._muteFlag;\n    },\n\n    playEffect (clip, loop) {\n        if (this._muteFlag) {\n            return;\n        }\n\n        if (loop === undefined || loop === null) {\n            loop = false;\n        }\n\n        let effectId = cc.audioEngine.play(clip, loop, this.m_effectVal);\n\n        // 如果是一直循环的音效添加列表中，调整音效的时候改变音乐大小\n        if(loop) {\n            this.m_id2Effect.push(effectId);\n        }\n\n        return effectId;\n    },\n\n    playWithCb(path, bLoop, cb){\n        if (this._muteFlag) {\n            return;\n        }\n\n        bLoop = typeof bLoop === 'undefined' ? false : bLoop;\n\n        let id = cc.audioEngine.play(path, bLoop);\n\n        cc.audioEngine.setFinishCallback(id, function () {\n            cb&&cb(id);\n        });\n\n        return id;\n    },\n\n    /**\n     * 停止播放音乐\n     */\n    stopMusic () {\n        if (this.m_musicId != undefined && this.m_musicId != null) {\n            cc.audioEngine.stop(this.m_musicId);\n            this.m_musicId = null;\n        }\n    },\n\n    /**\n     * 暂停音乐\n     */\n    pauseMusic: function() {\n        if (this.m_musicId != undefined && this.m_musicId != null) {\n            cc.audioEngine.pause(this.m_musicId);\n        }\n    },\n\n    /**\n     * 恢复音乐\n     */\n    resumeMusic: function() {\n        if (this.m_musicId != undefined && this.m_musicId != null) {\n            cc.audioEngine.resume(this.m_musicId);\n        }\n    },\n\n    setMute (mute) {\n        this._muteFlag = !!mute;\n    },\n\n    /**\n     *   停止所有正在播放资源\n     */\n    stopAll: function () {\n        this.m_musicId = null;\n        this.m_id2Effect.length = 0;\n\n        cc.audioEngine.stopAll();\n    }\n});"]}