{"version":3,"sources":["tm_base_scene.js"],"names":["window","tm","BaseScene","cc","Class","extends","require","properties","ui_parent","default","type","Node","top_hint_parent","common_sm_hint","Prefab","common_loading_effect","common_dialogBox","m_gameBgm","AudioClip","commom_scroll_msg_parent","common_scroll_msg","_startReconnect","_tempLaunchQuery","_commonBoxLogic","onLoad","_super","soundCore","playMusic","utils","adaptiveWin","hintPrb","instantiate","x","width","winSize","height","y","addChild","effectPrb","notifierCenter","register","Event","EVT_SYS_GAME_SHOW","onGameShow","_initCommomScrollMsg","uiObj","start","EVT_NET_WEB_SOCKET_RECT_BEGIN","onNetReconnect","EVT_NET_WEB_SOCKET_CONNECT","onNetReconnectOK","EVT_POP_COMMON_DIALOG_BOX","onPopDialogBox","onDestroy","stopMusic","data","getComponent","onShow","trigger","EVT_POP_COMMON_LOADING_EFFECT","bShow","title","String","NET_RECONNECT","isAgainDoLaunchLogic","res"],"mappings":"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","file":"tm_base_scene.js","sourceRoot":"../../../../../assets/commonScript/common","sourcesContent":["/**\n *\n * 内容: 场景基类\n *\n */\n\nwindow.tm = window.tm || {};\n\ntm.BaseScene = cc.Class({\n    extends:require(\"./tm_game_wapper\"),\n\n    properties: {\n\n        ui_parent:{\n            default:null,\n            type:cc.Node\n        },\n\n        top_hint_parent:{\n            default:null,\n            type:cc.Node\n        },\n\n        common_sm_hint:{\n            default:null,\n            type:cc.Prefab\n        },\n\n        common_loading_effect:{\n            default:null,\n            type:cc.Prefab\n        },\n\n        common_dialogBox:{\n            default:null,\n            type:cc.Prefab\n        },\n\n        // 音乐\n        m_gameBgm: {\n            type: cc.AudioClip,\n            default: null,\n        },\n\n        commom_scroll_msg_parent: cc.Node, // 跑马灯节点\n        common_scroll_msg: cc.Prefab, // 公用跑马灯\n\n        _startReconnect:false,\n\n        /*启动参数*/\n        _tempLaunchQuery:null,\n\n        _commonBoxLogic: null, // 通用弹窗\n    },\n\n    // LIFE-CYCLE CALLBACKS:\n\n    onLoad () {\n        this._super();\n        // 背景音乐\n        this.m_gameBgm && tm.soundCore.playMusic(this.m_gameBgm, true);\n\n        // 屏幕适配\n        tm.utils.adaptiveWin();\n\n        //\n        if(this.top_hint_parent){\n            //黑底小提示语\n            if(this.common_sm_hint){\n                let hintPrb = cc.instantiate(this.common_sm_hint);\n                hintPrb.x  = 0;\n                hintPrb.width = cc.winSize.width;\n                hintPrb.height = cc.winSize.height;\n                hintPrb.y  = 0;\n                this.top_hint_parent.addChild(hintPrb);\n            }\n\n            //转圈特效\n            if(this.common_loading_effect){\n                let effectPrb = cc.instantiate(this.common_loading_effect);\n                effectPrb.x  = 0;\n                effectPrb.y  = 0;\n                this.top_hint_parent.addChild(effectPrb);\n            }\n        }\n\n        //子类不要监听\n        tm.notifierCenter.register(tm.Event.EVT_SYS_GAME_SHOW, this.onGameShow, this);\n        this._initCommomScrollMsg();\n    },\n\n    /**\n     * 初始化通用跑马灯\n     * @private\n     */\n    _initCommomScrollMsg () {\n        if(this.commom_scroll_msg_parent) {\n\n            if(this.common_scroll_msg){\n                let uiObj = cc.instantiate(this.common_scroll_msg);\n                this.commom_scroll_msg_parent.addChild(uiObj);\n            }\n        }\n    },\n\n    start () {\n        //监听网络事件\n        tm.notifierCenter.register(tm.Event.EVT_NET_WEB_SOCKET_RECT_BEGIN, this.onNetReconnect, this);\n        tm.notifierCenter.register(tm.Event.EVT_NET_WEB_SOCKET_CONNECT, this.onNetReconnectOK, this);\n\n        //对话框\n        tm.notifierCenter.register(tm.Event.EVT_POP_COMMON_DIALOG_BOX, this.onPopDialogBox, this);\n    },\n\n    onDestroy(){\n        tm.soundCore.stopMusic();\n        this._super();\n    },\n\n    /**\n     *  通用对话框\n     *  tm.notifierCenter.trigger(tm.Event.EVT_POP_COMMON_DIALOG_BOX,{\n            msg: \"123\",\n            cb:function (error, res) {\n\n        }});\n     * @param data\n     */\n    onPopDialogBox(data){\n        //TODO:\n        if(!this._commonBoxLogic) {\n            if (this.common_dialogBox) {\n                let uiObj = cc.instantiate(this.common_dialogBox);\n                this.top_hint_parent.addChild(uiObj);\n                this._commonBoxLogic = uiObj.getComponent(\"tm_common_tip_view\");\n            }\n        }\n\n        if(this._commonBoxLogic) {\n            this._commonBoxLogic.onShow(data);\n        }\n    },\n\n    /**\n     * 网络开始重连\n     */\n    onNetReconnect(){\n        this._startReconnect = true;\n        tm.notifierCenter.trigger(tm.Event.EVT_POP_COMMON_LOADING_EFFECT,{\n            bShow:true,\n            title:tm.String.NET_RECONNECT,\n        });\n    },\n    /**\n     * 重连成功\n     */\n    onNetReconnectOK(){\n        if(this._startReconnect) {\n            tm.notifierCenter.trigger(tm.Event.EVT_POP_COMMON_LOADING_EFFECT, false);\n        }\n\n        this._startReconnect = false;\n    },\n\n    /**\n     * 断线重新是否重新启动登陆逻辑\n     * 子类重写\n     */\n    isAgainDoLaunchLogic(){\n        return true;\n    },\n\n    /**\n     *\n     * @param res\n     */\n    onGameShow(res){\n\n    },\n});\n"]}