{"version":3,"sources":["my_account_api.js"],"names":["require","myAccount","api","init","tm","notifierCenter","register","Event","EVT_INIT_USER_INFO","_initUserInfo","data","account","avatar","nickName","nick_name","phone","sex","trueName","true_name","identity","invite","invite_code","trigger","EVT_REFRESH_USER_INFO","_changeUserInfoByKey","key","info","LOGD","linkServer","host","post","netSocketIo","getUserNickName","toString","length","replace","substring","getUserSex","saveSex2Server","url","config","ip","plt","HttpAct","User","SaveSex","params","netHttpCore","error","status","saveNickName2Server","name","SaveNickName","saveUserAccount","accountNum","saveUserPassWord","password","getGoldTypeInfo2Server","Capital","Gold_Type","get","goldTypeInfo","EVT_REFRESH_GOLD_TYPE_INFO","localStorage","setItem","localStorageKey","GOLD_UPDATE_TYPE","goldTypeName","type_name","getGoldTypeName2LocalStorage","getItem","String","GOLD_TYPE_DEFAULT_NAME","getCurrGoldTypeInfo","i","oneInfo"],"mappings":"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","file":"my_account_api.js","sourceRoot":"../../../../../assets/frame/account","sourcesContent":["/**\n *\n * 内容: sdk接口\n *\n */\n\nrequire(\"./index\");\n\nmyAccount.api = (function (){\n\n    /*****************逻辑***************/\n\n    function init() {\n\n        tm.notifierCenter.register(tm.Event.EVT_INIT_USER_INFO, _initUserInfo, this);\n        \n    }\n\n    /**\n     * 初始化userinfo\n     * @param data\n     * @private\n     */\n    function _initUserInfo (data) {\n        myAccount.account.avatar = data.avatar;\n        myAccount.account.nickName = data.nick_name;\n        myAccount.account.phone = data.phone;\n        myAccount.account.sex = data.sex;\n        myAccount.account.trueName = data.true_name;\n        //myAccount.account.userId = data.phone;\n        myAccount.account.identity = data.identity;\n        myAccount.account.invite = data.invite_code;\n\n        tm.notifierCenter.trigger(tm.Event.EVT_REFRESH_USER_INFO);\n    }\n\n    /**\n     * 通过数据改变userInfo数据\n     * @param key\n     * @param info\n     * @private\n     */\n    function _changeUserInfoByKey (key, info) {\n        if(myAccount.account[key]) {\n            myAccount.account[key] = info;\n\n            tm.notifierCenter.trigger(tm.Event.EVT_REFRESH_USER_INFO);\n        } else {\n            tm.LOGD(\"my_account_api \", \"_changeUserInfo wrong Key: \", key);\n        }\n    }\n\n    function linkServer(host, post) {\n        tm.netSocketIo.linkServer(host, post)\n    }\n\n    /**savenick\n     * 获取玩家昵称\n     */\n    function getUserNickName () {\n        let nickName = myAccount.account.nickName;\n        if(!nickName || nickName != \"\") {\n            let phone = myAccount.account.phone.toString();\n            if(phone.length > 10){\n                nickName = phone.replace(phone.substring(3,7), \"****\");\n            }else{\n                nickName = phone;\n            }\n        }\n\n        return nickName;\n    }\n\n    /**\n     * 获取用户性别\n     * @returns {number}\n     */\n    function getUserSex () {\n        return myAccount.account.sex || 1;\n    }\n\n    /*******************用户数据http请求接口*************/\n\n    /**\n     * 保存性别到服务器\n     */\n    function saveSex2Server(sex) {\n        let url = myAccount.config.ip + plt.HttpAct.User.SaveSex;\n        let params = {\n            \"sex\": sex\n        };\n\n        tm.netHttpCore.post(url, params, function (error, data) {\n            if(!error){\n                if(data.status == 0) {\n                    _initUserInfo(data.data);\n                }\n            }\n        }, this);\n    }\n\n    /**\n     * 保存名字到服务器到服务器\n     */\n    function saveNickName2Server(name) {\n        let url = myAccount.config.ip + plt.HttpAct.User.SaveNickName;\n        let params = {\n            \"nick_name\": name\n        };\n\n        tm.netHttpCore.post(url, params, function (error, data) {\n            if(!error){\n                if(data.status == 0) {\n                    _initUserInfo(data.data);\n                }\n            }\n        }, this);\n    }\n\n    /**\n     * 保存用户账户\n     */\n    function saveUserAccount (account) {\n        myAccount.account.accountNum = account;\n    }\n\n    /**\n     * 保存用户密码\n     */\n    function saveUserPassWord (password) {\n        myAccount.account.password = password;\n    }\n\n    /**\n     * 获取服务器金币类型信息\n     */\n    function getGoldTypeInfo2Server () {\n        let url = myAccount.config.ip + plt.HttpAct.Capital.Gold_Type;\n        tm.netHttpCore.get(url, null, function (error, data) {\n            if(!error){\n                if(data.status == 0) {\n                    myAccount.account.goldTypeInfo = data.data;\n                    tm.notifierCenter.trigger(tm.Event.EVT_REFRESH_GOLD_TYPE_INFO);\n                    tm.localStorage.setItem(tm.localStorageKey.GOLD_UPDATE_TYPE, {goldTypeName:myAccount.account.goldTypeInfo[0].type_name});\n                    getGoldTypeName2LocalStorage();\n                }\n            }\n        }, this);\n    }\n\n    function getGoldTypeName2LocalStorage(){\n        let data = tm.localStorage.getItem(tm.localStorageKey.GOLD_UPDATE_TYPE);\n        if(data != null && data != 'null'){\n            myAccount.account.goldTypeName = data.goldTypeName;\n        }else{\n            if(myAccount.account.goldTypeInfo){\n                myAccount.account.goldTypeName = myAccount.account.goldTypeInfo[0].type_name;\n            }else{\n                myAccount.account.goldTypeName = myAccount.String.GOLD_TYPE_DEFAULT_NAME;\n            }\n        }\n    }\n\n    /**\n     * 获取金币类型名字\n     */\n    function getCurrGoldTypeInfo () {\n        let info = null;\n        if(myAccount.account.goldTypeName && myAccount.account.goldTypeInfo && myAccount.account.goldTypeInfo.length) {\n            for (let i = 0; i <  myAccount.account.goldTypeInfo.length; i++) {\n                let oneInfo =  myAccount.account.goldTypeInfo[i];\n                if(oneInfo && oneInfo.type_name == myAccount.account.goldTypeName) {\n                    info = oneInfo;\n                    break;\n                }\n            }\n        }\n\n        return  info;\n    }\n\n    return {\n        \"init\":init,\n        \"linkServer\":linkServer,\n        \"getUserNickName\": getUserNickName,\n        \"getUserSex\": getUserSex,\n        \"saveSex2Server\": saveSex2Server,\n        \"saveNickName2Server\": saveNickName2Server,\n        \"saveUserAccount\": saveUserAccount,\n        \"saveUserPassWord\": saveUserPassWord,\n        \"getGoldTypeInfo2Server\": getGoldTypeInfo2Server,\n        \"getCurrGoldTypeInfo\": getCurrGoldTypeInfo,\n        \"getGoldTypeName2LocalStorage\": getGoldTypeName2LocalStorage,\n    }\n\n})();\n\n"]}